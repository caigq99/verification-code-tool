__wxCodeSpace__.batchAddCompiledTemplate(function(G,R,D,Q,gdc,X,Y,Z,RG={}){var P=RG.P||function(a){return typeof a==='function'?a:()=>{}};return {'pages/code/code':(()=>{var H={};var S;var I=(P)=>{if(!S)S=Object.assign({},H);return S[P]};H[""]=(R,C,D,U)=>{var L=R.c,M=R.m,O=R.r,A={"animationState":new Array(3),"systemInfo":new Array(2),"softwareInfo":new Array(4)},K=U===true,c=(C)=>{},h=(C,T)=>{C||K||Z(U.softwareInfo,"name")?T(Y(X(D.softwareInfo).name),(N)=>{A["softwareInfo"][0]=(D,E,T)=>{T(N,Y(X(D.softwareInfo).name))}}):T()},i=(C,T)=>{C||K||Z(U.softwareInfo,"description")?T(Y(X(D.softwareInfo).description),(N)=>{A["softwareInfo"][1]=(D,E,T)=>{T(N,Y(X(D.softwareInfo).description))}}):T()},j=(C,T)=>{C?T("v6.3.0"):T()},g=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"software-name")},h);E("text",{},(N,C)=>{if(C)L(N,"software-desc")},i);E("text",{},(N,C)=>{if(C)L(N,"version-text")},j)},f=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"software-details")},g)},k=(C,T)=>{C?T("你的码，来了"):T()},m,p=(C,T)=>{C?T("获取一言中"):T()},r=(C)=>{},s=(C)=>{},t=(C)=>{},q=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"dot gpu-accelerated")},r);E("view",{},(N,C)=>{if(C)L(N,"dot gpu-accelerated")},s);E("view",{},(N,C)=>{if(C)L(N,"dot gpu-accelerated")},t)},o=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"loading-text")},p);E("view",{},(N,C)=>{if(C)L(N,"loading-dots")},q)},v=(C,T)=>{C||K||!!Z(U.hitokoto,"text")||undefined?T(Y("「 "+Y(X(D.hitokoto).text)+" 」")):T()},u=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"hitokoto-text")},v)},n=(C,T,E)=>{if(m===1){E("view",{},(N,C)=>{if(C)L(N,"hitokoto-loading gpu-accelerated")},o)}else{E("view",{},(N,C)=>{if(C)L(N,"hitokoto-content gpu-accelerated")},u)}},l=(C,T,E,B)=>{m=X(D.hitokoto).loading?1:0;B(m,n)},e=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"software-info-header")},f);E("text",{},(N,C)=>{if(C)L(N,"page-title gpu-accelerated")},k);E("view",{},(N,C)=>{if(C)L(N,"hitokoto-section smooth-animation")},l)},x,A0=(C,T)=>{C?T("获取验证码中"):T()},C0=(C)=>{},D0=(C)=>{},E0=(C)=>{},B0=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"loading-dot gpu-accelerated")},C0);E("view",{},(N,C)=>{if(C)L(N,"loading-dot gpu-accelerated")},D0);E("view",{},(N,C)=>{if(C)L(N,"loading-dot gpu-accelerated")},E0)},z=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"loading-text")},A0);E("view",{},(N,C)=>{if(C)L(N,"loading-dots")},B0)},G0,K0=(C,T)=>{C?T("哎呀获取失败了，请点击按钮重新获取或更换网络后重试"):T()},J0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"error-hint")},K0)},M0=(C,T)=>{C?T("重新获取"):T()},L0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"refresh-text")},M0)},I0=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"error-content")},J0);E("view",{},(N,C)=>{if(C)L(N,"refresh-button");if(C)O(N,"bindtap","refreshVerificationCode")},L0)},P0=(C,Q0,R0,S0,T0,U0,T,E)=>{var V0=(C,T)=>{C||K||Z(S0,"char")?T(Y(X(Q0).char)):T()};E("text",{},(N,C)=>{var $A=X(Q0).type==="letter";if(C||K||!!(Z(S0,"type")||($A?undefined:undefined))||undefined)L(N,"code-char "+Y($A?"code-letter":"code-number"))},V0)},O0=(C,T,E,B,F)=>{F(D.codeCharacters,"index",U?U.codeCharacters:undefined,[0,"codeCharacters"],P0)},Q0=(C)=>{},T0=(C,T)=>{C?T("字母"):T()},U0=(C,T)=>{C?T("数字"):T()},S0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"tip-sample letter-sample")},T0);E("text",{},(N,C)=>{if(C)L(N,"tip-sample number-sample")},U0)},R0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"tip-text")},S0)},V0,Y0,a0=(C,T)=>{C?T("验证码已过期"):T()},b0=(C,T)=>{C||K||!!Z(U.countdown,"timeText")||undefined?T(Y(Y(X(D.countdown).timeText)+" 后验证码过期")):T()},Z0=(C,T,E)=>{if(Y0===1){E("text",{},(N,C)=>{if(C)L(N,"countdown-text expired")},a0)}else{E("text",{},(N,C)=>{if(C)L(N,"countdown-text")},b0)}},X0=(C,T,E,B)=>{Y0=X(D.countdown).expired?1:0;B(Y0,Z0)},W0=(C,T,E)=>{if(V0===1){E("view",{},(N,C)=>{if(C)L(N,"countdown-section")},X0)}},N0=(C,T,E,B)=>{E("view",{},(N,C)=>{if(C)L(N,"code-text-container");if(C)O(N,"bindlongpress","copyVerificationCode")},O0);E("view",{},(N,C)=>{if(C)L(N,"code-underline gpu-accelerated")},Q0);E("view",{},(N,C)=>{if(C)L(N,"color-tips")},R0);V0=X(D.countdown).show?1:0;B(V0,W0)},H0=(C,T,E)=>{if(G0===1){E("view",{},(N,C)=>{if(C)L(N,"code-error gpu-accelerated")},I0)}else{E("view",{},(N,C)=>{if(C)L(N,"code-content gpu-accelerated")},N0)}},F0=(C,T,E,B)=>{G0=D.codeError?1:0;B(G0,H0)},y=(C,T,E)=>{if(x===1){E("view",{},(N,C)=>{if(C)L(N,"loading-state gpu-accelerated")},z)}else{E("view",{},(N,C)=>{if(C)L(N,"code-card gpu-accelerated")},F0)}},w=(C,T,E,B)=>{x=D.codeLoading?1:0;B(x,y)},d0=(C,T)=>{C?T("⚠\u{fe0f} 验证码有效且输入正确但软件提示错误，请重启软件后再重新输入"):T()},c0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"warning-text")},d0)},f0=(C,T)=>{C?T("⚠\u{fe0f} 验证码具有时效性，请及时使用"):T()},e0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"warning-text")},f0)},i0=(C,T)=>{C?T("📋"):T()},j0=(C,T)=>{C||K||!!Z(U.softwareInfo,"name")||undefined?T(Y("验证码实际用途 "+Y(X(D.softwareInfo).name)+"激活指南"),(N)=>{A["softwareInfo"][2]=(D,E,T)=>{T(N,Y("验证码实际用途 "+Y(X(D.softwareInfo).name)+"激活指南"))}}):T()},h0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"guide-icon")},i0);E("text",{},(N,C)=>{if(C)L(N,"guide-title")},j0)},m0=(C,T)=>{C?T("⚡"):T()},n0=(C,T)=>{C?T("主要功能"):T()},l0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"subtitle-icon")},m0);E("text",{},(N,C)=>{if(C)L(N,"subtitle-text")},n0)},p0,t0=(C,T)=>{C?T("•"):T()},u0=(C,T)=>{C?T("自动注册Cursor应用账户"):T()},s0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},t0);E("text",{},(N,C)=>{if(C)L(N,"function-text")},u0)},w0=(C,T)=>{C?T("•"):T()},x0=(C,T)=>{C?T("重置/初始化Cursor应用"):T()},v0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},w0);E("text",{},(N,C)=>{if(C)L(N,"function-text")},x0)},z0=(C,T)=>{C?T("•"):T()},A1=(C,T)=>{C?T("解决Cursor使用限制问题"):T()},y0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},z0);E("text",{},(N,C)=>{if(C)L(N,"function-text")},A1)},r0=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"function-item")},s0);E("view",{},(N,C)=>{if(C)L(N,"function-item")},v0);E("view",{},(N,C)=>{if(C)L(N,"function-item")},y0)},q0=(C,T,E)=>{if(p0===1){E("view",{},(N,C)=>{if(C)L(N,"function-list")},r0)}},B1,F1=(C,T)=>{C?T("•"):T()},G1=(C,T)=>{C?T("重置Augment插件状态"):T()},E1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},F1);E("text",{},(N,C)=>{if(C)L(N,"function-text")},G1)},I1=(C,T)=>{C?T("•"):T()},J1=(C,T)=>{C?T("自定义随机生成YAugment邮箱"):T()},H1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},I1);E("text",{},(N,C)=>{if(C)L(N,"function-text")},J1)},L1=(C,T)=>{C?T("•"):T()},M1=(C,T)=>{C?T("获取YAugment注册验证码"):T()},K1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"function-bullet")},L1);E("text",{},(N,C)=>{if(C)L(N,"function-text")},M1)},D1=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"function-item")},E1);E("view",{},(N,C)=>{if(C)L(N,"function-item")},H1);E("view",{},(N,C)=>{if(C)L(N,"function-item")},K1)},C1=(C,T,E)=>{if(B1===1){E("view",{},(N,C)=>{if(C)L(N,"function-list")},D1)}},o0=(C,T,E,B)=>{p0=D.software==="YCursor"?1:0;B(p0,q0);B1=D.software==="YAugment"?1:0;B(B1,C1)},k0=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"section-subtitle")},l0);E("view",{},(N,C)=>{if(C)L(N,"function-content")},o0)},P1=(C,T)=>{C?T("🔑"):T()},Q1=(C,T)=>{C?T("激活步骤"):T()},O1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"subtitle-icon")},P1);E("text",{},(N,C)=>{if(C)L(N,"subtitle-text")},Q1)},T1=(C,T)=>{C?T("1"):T()},U1=(C,T)=>{C?T("复制上方验证码（长按验证码可复制）"):T()},S1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"item-number")},T1);E("text",{},(N,C)=>{if(C)L(N,"item-text")},U1)},W1=(C,T)=>{C?T("2"):T()},X1=(C,T)=>{C||K||!!Z(U.softwareInfo,"name")||undefined?T(Y("打开"+Y(X(D.softwareInfo).name)+"应用程序"),(N)=>{A["softwareInfo"][3]=(D,E,T)=>{T(N,Y("打开"+Y(X(D.softwareInfo).name)+"应用程序"))}}):T()},V1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"item-number")},W1);E("text",{},(N,C)=>{if(C)L(N,"item-text")},X1)},Z1=(C,T)=>{C?T("3"):T()},a1=(C,T)=>{C?T("在激活界面输入复制的验证码"):T()},Y1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"item-number")},Z1);E("text",{},(N,C)=>{if(C)L(N,"item-text")},a1)},c1=(C,T)=>{C?T("4"):T()},d1=(C,T)=>{C?T("激活成功后即可使用所有功能"):T()},b1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"item-number")},c1);E("text",{},(N,C)=>{if(C)L(N,"item-text")},d1)},R1=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"guide-item")},S1);E("view",{},(N,C)=>{if(C)L(N,"guide-item")},V1);E("view",{},(N,C)=>{if(C)L(N,"guide-item")},Y1);E("view",{},(N,C)=>{if(C)L(N,"guide-item")},b1)},N1=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"section-subtitle")},O1);E("view",{},(N,C)=>{if(C)L(N,"guide-content")},R1)},g0=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"guide-header")},h0);E("view",{},(N,C)=>{if(C)L(N,"function-section")},k0);E("view",{},(N,C)=>{if(C)L(N,"steps-section")},N1)},f1=(C,T)=>{C?T("＜"):T()},e1=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"back-button");if(C)O(N,"bindtap","navigateBack")},f1)},d=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"title-section smooth-animation")},e);E("view",{},(N,C)=>{if(C)L(N,"code-display smooth-animation")},w);E("view",{},(N,C)=>{if(C)L(N,"time-warning")},c0);E("view",{},(N,C)=>{if(C)L(N,"time-warning")},e0);E("view",{},(N,C)=>{if(C)L(N,"usage-guide smooth-animation")},g0);E("view",{},(N,C)=>{if(C)L(N,"back-button-container");if(C||K||!!(Z(U.systemInfo,"backButtonTop")||Z(U.systemInfo,"backButtonLeft"))||undefined)R.y(N,"top:"+Y(X(D.systemInfo).backButtonTop)+"px;left:"+Y(X(D.systemInfo).backButtonLeft)+"px;");A["systemInfo"][0]=A["systemInfo"][1]=(D,E,T)=>{R.y(N,"top:"+Y(X(D.systemInfo).backButtonTop)+"px;left:"+Y(X(D.systemInfo).backButtonLeft)+"px;")}},e1)},b=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"bg-gradient gpu-accelerated")},c);E("view",{},(N,C)=>{var $A=X(D.animationState).contentReady;if(C||K||!!(Z(U.animationState,"contentReady")||($A?undefined:undefined))||undefined)L(N,"main-content "+Y($A?"content-ready":"")+" gpu-accelerated");A["animationState"][2]=(D,E,T)=>{var $B=X(D.animationState).contentReady;L(N,"main-content "+Y($B?"content-ready":"")+" gpu-accelerated")}},d)},a=(C,T,E)=>{E("view",{},(N,C)=>{var $A=X(D.animationState).isExiting;var $B=X(D.animationState).isEntering;if(C||K||!!(Z(U.animationState,"isExiting")||($A?undefined:undefined)||Z(U.animationState,"isEntering")||($B?undefined:undefined))||undefined)L(N,"code-container "+Y($A?"page-exiting":"")+" "+Y($B?"page-entering":""));A["animationState"][0]=A["animationState"][1]=(D,E,T)=>{var $C=X(D.animationState).isExiting;var $D=X(D.animationState).isEntering;L(N,"code-container "+Y($C?"page-exiting":"")+" "+Y($D?"page-entering":""))}},b)};;return {C:a,B:A}};return Object.assign(function(R){return H[R]},{_:H})})(),}});;__wxRoute = "pages/code/code";__wxRouteBegin = true;__wxAppCurrentFile__="pages/code/code.js";define("pages/code/code.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";require("../../@babel/runtime/helpers/Arrayincludes");var t=require("../../@babel/runtime/helpers/regeneratorRuntime"),e=require("../../@babel/runtime/helpers/asyncToGenerator"),o=require("../../AE61E3604B3CC87FC8078B67643A8012.js");Page({countdownTimer:null,data:{verificationCode:"",codeCharacters:[],codeLoading:!0,codeError:!1,software:"YCursor",softwareInfo:{name:"YCursor",description:"Y 系列"},countdown:{show:!1,timeText:"",totalSeconds:0,expired:!1},hitokoto:{text:"加载中...",from:"",from_who:"",loading:!0,error:!1},animationState:{isEntering:!0,isExiting:!1,contentReady:!1,animationQueue:[]},systemInfo:{statusBarHeight:44,menuButtonHeight:32,menuButtonTop:0,backButtonTop:0,backButtonLeft:16},sessionId:"",sessionExpiresAt:"",tempToken:"",showAdPrompt:!1,adWatchStartTime:0,apiSignatureSecret:"",apiKeyVersion:0,apiKeyLastUpdate:0},onLoad:function(t){var e=this;this.clearEasterCount(),this.getSystemInfo(),this.initPageAnimation();try{this.generateDeviceFingerprint()}catch(t){}var o=t.software||"YCursor",n=t.sessionId,r=t.tempToken?decodeURIComponent(t.tempToken):null;this.setSoftwareInfo(o),this.fetchCurrentSignatureKey().then((function(){n&&r?(e.setData({sessionId:n,tempToken:r}),e.fetchVerificationCodeWithSession(n,r)):e.fetchVerificationCode()})).catch((function(t){console.error("获取签名密钥失败:",t),n&&r?(e.setData({sessionId:n,tempToken:r}),e.fetchVerificationCodeWithSession(n,r)):e.fetchVerificationCode()})),this.fetchHitokoto()},setSoftwareInfo:function(t){var e={YCursor:{name:"YCursor",description:"Y 系列"},YAugment:{name:"YAugment",description:"Y 系列"}},o=e[t]||e.YCursor;this.setData({software:t,softwareInfo:o})},processVerificationCode:function(t){for(var e=[],o=0;o<t.length;o++){var n=t[o],r=/[0-9]/.test(n)?"number":"letter";e.push({char:n,type:r})}return e},clearEasterCount:function(){try{wx.setStorageSync("easterCount",0)}catch(t){}},getSystemInfo:function(){var t=wx.getSystemInfoSync(),e=wx.getMenuButtonBoundingClientRect(),o=e.top+6,n=t.windowWidth-e.right+8;this.setData({"systemInfo.statusBarHeight":t.statusBarHeight,"systemInfo.menuButtonHeight":e.height,"systemInfo.menuButtonTop":e.top,"systemInfo.backButtonTop":o,"systemInfo.backButtonLeft":n})},generateDeviceFingerprint:function(){try{var t,e,n=wx.getSystemInfoSync(),r=wx.getAccountInfoSync(),a={model:n.model||"unknown",platform:n.platform||"unknown",version:n.version||"unknown",system:n.system||"unknown",language:n.language||"unknown",screenWidth:n.screenWidth||0,screenHeight:n.screenHeight||0,windowWidth:n.windowWidth||0,windowHeight:n.windowHeight||0,pixelRatio:n.pixelRatio||1,appId:(null==r||null===(t=r.miniProgram)||void 0===t?void 0:t.appId)||"unknown",envVersion:(null==r||null===(e=r.miniProgram)||void 0===e?void 0:e.envVersion)||"unknown",timestamp:Date.now(),random:Math.random(),statusBarHeight:n.statusBarHeight||0,safeArea:n.safeArea?{top:n.safeArea.top,bottom:n.safeArea.bottom,left:n.safeArea.left,right:n.safeArea.right}:null,networkType:"unknown",benchMark:n.benchmarkLevel||0,brand:n.brand||"unknown"};try{wx.getNetworkType({success:function(t){a.networkType=t.networkType||"unknown"},fail:function(){a.networkType="unknown"}})}catch(t){a.networkType="unknown"}var i=JSON.stringify(a);return o.SHA256(i).toString()}catch(t){try{var s={timestamp:Date.now(),random:Math.random(),userAgent:"miniprogram",fallback:!0};try{var c=wx.getSystemInfoSync();s.platform=c.platform||"unknown",s.version=c.version||"unknown"}catch(t){s.platform="unknown",s.version="unknown"}var d=JSON.stringify(s);return o.SHA256(d).toString()}catch(t){var u=Date.now().toString()+Math.random().toString();return o.SHA256(u).toString()}}},initPageAnimation:function(){var t=this;wx.nextTick((function(){t.setData({"animationState.isEntering":!0}),setTimeout((function(){t.setData({"animationState.contentReady":!0,"animationState.isEntering":!1})}),80)}))},createAdSession:function(o,n){var r=this;return e(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var a={project_id:o,device_fingerprint:n},i=r.generateSignedHeaders("POST","/api/public/ad-session",a);wx.request({url:"https://app.yan.vin/api/public/ad-session",method:"POST",header:i,data:a,success:function(o){200===o.statusCode&&o.data?o.data.error?e(new Error(o.data.error)):t(o.data):429===o.statusCode?(wx.showModal({title:"请求频率过高",content:"频率太高，无法创建会话，请等待一会稍后再试。请不要短时间内频繁重复，避免进风控小黑屋。",showCancel:!1,confirmText:"我知道了",confirmColor:"#ff6b6b"}),e(new Error("Rate limit exceeded"))):e(new Error("Invalid response"))},fail:function(t){e(t)}})})));case 1:case"end":return t.stop()}}),e)})))()},verifyAdCompletion:function(o,n,r){var a=this;return e(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var i={session_id:o,watch_duration:n,completion_proof:r||""},s=a.generateSignedHeaders("POST","/api/public/ad-verify",i);wx.request({url:"https://app.yan.vin/api/public/ad-verify",method:"POST",header:s,data:i,success:function(o){200===o.statusCode&&o.data?o.data.error?e(new Error(o.data.error)):t(o.data):429===o.statusCode?(wx.showModal({title:"请求频率过高",content:"频率太高，无法验证广告观看，请等待一会稍后再试。请不要短时间内频繁重复，避免进风控小黑屋。",showCancel:!1,confirmText:"我知道了",confirmColor:"#ff6b6b"}),e(new Error("Rate limit exceeded"))):e(new Error("Invalid response"))},fail:function(t){e(t)}})})));case 1:case"end":return t.stop()}}),e)})))()},getVerificationCodeWithSession:function(o,n,r){var a=this;return e(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){var i={project_id:o,session_id:n,temp_token:r},s=a.generateSignedHeaders("POST","/api/public/verification-code",i);wx.request({url:"https://app.yan.vin/api/public/verification-code",method:"POST",header:s,data:i,success:function(o){if(200===o.statusCode&&o.data)o.data.error?e(new Error(o.data.error)):t(o.data);else if(400===o.statusCode){var n,r=(null===(n=o.data)||void 0===n?void 0:n.error)||"Session not verified";e(new Error(r))}else if(401===o.statusCode){var a,i=(null===(a=o.data)||void 0===a?void 0:a.error)||"Invalid signature";e(new Error(i))}else if(404===o.statusCode){var s,c=(null===(s=o.data)||void 0===s?void 0:s.error)||"Session not found or expired";e(new Error(c))}else if(429===o.statusCode){var d,u=(null===(d=o.data)||void 0===d?void 0:d.error)||"Rate limit exceeded";e(new Error(u))}else{var f,h=(null===(f=o.data)||void 0===f?void 0:f.error)||"Invalid response (".concat(o.statusCode,")");e(new Error(h))}},fail:function(t){e(t)}})})));case 1:case"end":return t.stop()}}),e)})))()},startThreeStageVerification:function(){var o=this;return e(t().mark((function e(){var n,r;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=o.generateDeviceFingerprint(),t.next=4,o.createAdSession(o.data.software,n);case 4:if((r=t.sent).session_id){t.next=7;break}throw new Error("Failed to create session: no session_id");case 7:return o.setData({sessionId:r.session_id,sessionExpiresAt:r.expires_at}),o.showRewardedAd(),t.abrupt("return",!0);case 12:throw t.prev=12,t.t0=t.catch(0),t.t0;case 15:case"end":return t.stop()}}),e,null,[[0,12]])})))()},handleAdWatchCompleted:function(o){var n=this;return e(t().mark((function e(){var r,a,i,s,c;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=n.data.sessionId){t.next=4;break}throw new Error("No session ID available");case 4:return t.next=6,n.verifyAdCompletion(r,o);case 6:if((a=t.sent).verified&&a.temp_token){t.next=9;break}throw new Error("Ad verification failed");case 9:return n.setData({tempToken:a.temp_token}),t.next=12,n.getVerificationCodeWithSession(n.data.software,r,a.temp_token);case 12:if((i=t.sent).data){t.next=15;break}throw new Error("Failed to get verification code");case 15:s=n.decryptVerificationData(i.data),c=n.processVerificationCode(s.code),n.setData({verificationCode:s.code,codeCharacters:c,codeLoading:!1,codeError:!1}),s.expires_at&&n.startCountdown(s.expires_at),t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),n.handleCodeError("验证码获取失败，请重试");case 24:case"end":return t.stop()}}),e,null,[[0,21]])})))()},fetchCurrentSignatureKey:function(){var t=this;return new Promise((function(e,o){var n=Date.now();t.data.apiSignatureSecret&&n-t.data.apiKeyLastUpdate<3e5?e():wx.request({url:"https://app.yan.vin/api/public/signature-key",method:"GET",header:{"Content-Type":"application/json",Referer:"https://servicewechat.com/wx421aabd7feefa0ed/devtools/page-frame.html"},success:function(o){200===o.statusCode&&o.data?o.data.key&&o.data.version?(t.setData({apiSignatureSecret:o.data.key,apiKeyVersion:o.data.version,apiKeyLastUpdate:n}),e()):(console.error("获取签名密钥失败: 响应数据格式错误"),t.setData({apiSignatureSecret:"YAN_API_SIGN_2025_ULTRA_SECRET_KEY_FOR_SIGNATURE_VERIFICATION_9f8e7d6c5b4a3210",apiKeyVersion:1,apiKeyLastUpdate:n}),e()):(console.error("获取签名密钥失败: HTTP状态码",o.statusCode),t.setData({apiSignatureSecret:"YAN_API_SIGN_2025_ULTRA_SECRET_KEY_FOR_SIGNATURE_VERIFICATION_9f8e7d6c5b4a3210",apiKeyVersion:1,apiKeyLastUpdate:n}),e())},fail:function(o){console.error("获取签名密钥网络请求失败:",o),t.setData({apiSignatureSecret:"YAN_API_SIGN_2025_ULTRA_SECRET_KEY_FOR_SIGNATURE_VERIFICATION_9f8e7d6c5b4a3210",apiKeyVersion:1,apiKeyLastUpdate:n}),e()}})}))},generateApiSignature:function(t,e,n,r,a){try{var i="";if(n){var s=Object.keys(n).sort(),c={};s.forEach((function(t){c[t]=n[t]})),i=JSON.stringify(c).replace(/\s/g,"")}var d="".concat(t.toUpperCase(),"\n").concat(e,"\n").concat(i,"\n").concat(r,"\n").concat(a);return o.HmacSHA256(d,this.data.apiSignatureSecret).toString()}catch(t){return null}},generateSignedHeaders:function(t,e,o){this.data.apiSignatureSecret||(console.warn("API签名密钥未初始化，使用默认v1密钥"),this.setData({apiSignatureSecret:"YAN_API_SIGN_2025_ULTRA_SECRET_KEY_FOR_SIGNATURE_VERIFICATION_9f8e7d6c5b4a3210",apiKeyVersion:1,apiKeyLastUpdate:Date.now()}));var n=Math.floor(Date.now()/1e3).toString(),r=Math.random().toString(36).substr(2,16);return{"Content-Type":"application/json","X-YAN-Signature":this.generateApiSignature(t,e,o,n,r),"X-YAN-Timestamp":n,"X-YAN-Nonce":r}},fetchVerificationCodeWithSession:function(t,e){var o=this;this.setData({codeLoading:!0,codeError:!1,verificationCode:"",codeCharacters:[]});var n={project_id:this.data.software,session_id:t,temp_token:e},r=this.generateSignedHeaders("POST","/api/public/verification-code",n);wx.request({url:"https://app.yan.vin/api/public/verification-code",method:"POST",header:r,data:n,success:function(t){if(200===t.statusCode&&t.data)if(t.data.error)o.handleCodeError(t.data.error);else if(t.data.data)try{var n=o.decryptVerificationDataWithTempKey(t.data.data,e),r=o.processVerificationCode(n.code);o.setData({verificationCode:n.code,codeCharacters:r,codeLoading:!1,codeError:!1}),n.expires_at&&o.startCountdown(n.expires_at)}catch(t){o.handleCodeError("解密失败")}else o.handleCodeError("无效的响应数据");else if(400===t.statusCode){var a,i=(null===(a=t.data)||void 0===a?void 0:a.error)||"Session not verified";o.handleCodeError(i)}else if(401===t.statusCode){var s,c=(null===(s=t.data)||void 0===s?void 0:s.error)||"Invalid signature";o.handleCodeError(c)}else if(404===t.statusCode){var d,u=(null===(d=t.data)||void 0===d?void 0:d.error)||"Session not found or expired";o.handleCodeError(u)}else if(429===t.statusCode)wx.showModal({title:"请求频率过高",content:"频率太高，无法获取验证码，请等待一会稍后再试。请不要短时间内频繁重复，避免进风控小黑屋。",showCancel:!1,confirmText:"我知道了",confirmColor:"#ff6b6b"}),o.handleCodeError("频率限制");else{var f,h=(null===(f=t.data)||void 0===f?void 0:f.error)||"网络请求失败 (".concat(t.statusCode,")");o.handleCodeError(h)}},fail:function(){o.handleCodeError("网络连接失败")}})},fetchVerificationCode:function(){var o=this;return e(t().mark((function e(){return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.setData({codeLoading:!0,codeError:!1,verificationCode:"",codeCharacters:[]}),t.prev=1,t.next=4,o.startThreeStageVerification();case 4:if(!t.sent){t.next=8;break}return o.setData({codeLoading:!1,showAdPrompt:!0}),t.abrupt("return");case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),o.handleCodeError("验证流程启动失败，请重试");case 13:case"end":return t.stop()}}),e,null,[[1,10]])})))()},showRewardedAd:function(){var t=this;try{if(this.setData({adWatchStartTime:Date.now()}),!wx.createRewardedVideoAd)return wx.showToast({title:"当前环境不支持广告",icon:"none"}),void this.handleCodeError("当前环境不支持广告功能");var e=wx.createRewardedVideoAd({adUnitId:"adunit-xxxxxxxxxxxxxxxx"});e.onLoad((function(){})),e.onError((function(){wx.showToast({title:"广告加载失败",icon:"none"}),t.handleCodeError("广告加载失败，请重试")})),e.onClose((function(e){var o=Date.now()-t.data.adWatchStartTime;e&&e.isEnded?t.handleAdWatchCompleted(o):(wx.showToast({title:"请观看完整广告",icon:"none"}),t.handleCodeError("需要观看完整广告才能获取验证码"))})),e.show().then((function(){})).catch((function(){e.load().then((function(){return e.show()})).catch((function(){wx.showToast({title:"广告显示失败",icon:"none"}),t.handleCodeError("广告显示失败，请重试")}))}))}catch(t){this.handleCodeError("广告功能异常，请重试")}},handleCodeError:function(t){this.setData({codeLoading:!1,codeError:!0,verificationCode:"",codeCharacters:[]}),this.showErrorDialog(t)},showErrorDialog:function(t){var e="获取失败",o=t,n=!1;t.includes("Session not found")||t.includes("Session not verified")||t.includes("会话不存在")||t.includes("会话状态无效")||t.includes("expired")||t.includes("过期")?(e="会话已过期",o="当前会话已过期或无效，需要重新进入小程序获取验证码。",n=!0):t.includes("Project ID mismatch")||t.includes("项目ID不匹配")?(e="项目不匹配",o="项目信息不匹配，请重新进入小程序。",n=!0):t.includes("Invalid signature")||t.includes("签名验证失败")?(e="验证失败",o="安全验证失败，请重新进入小程序。",n=!0):t.includes("Rate limit")||t.includes("频率限制")?(e="请求过于频繁",o="请求频率过高，请稍后再试。"):(t.includes("网络")||t.includes("连接"))&&(e="网络错误",o="网络连接异常，请检查网络后重试。"),n?wx.showModal({title:e,content:o+'\n\n点击"重新进入"将返回首页重新开始。',showCancel:!0,cancelText:"取消",confirmText:"重新进入",confirmColor:"#007aff",success:function(t){t.confirm&&wx.reLaunch({url:"/pages/software-select/software-select"})}}):wx.showModal({title:e,content:o,showCancel:!1,confirmText:"我知道了",confirmColor:"#007aff"})},refreshVerificationCode:function(){this.clearCountdown();var t=this.data.sessionId,e=this.data.tempToken;t&&e?this.fetchVerificationCodeWithSession(t,e):this.fetchVerificationCode()},startCountdown:function(t){var e=this;this.clearCountdown();var o=new Date(t).getTime(),n=Date.now();if(o<=n)this.setData({"countdown.show":!0,"countdown.expired":!0,"countdown.totalSeconds":0});else{var r=Math.floor((o-n)/1e3);this.setData({"countdown.show":!0,"countdown.expired":!1,"countdown.totalSeconds":r}),this.updateCountdownDisplay(r),this.countdownTimer=setInterval((function(){var t=Date.now(),n=Math.floor((o-t)/1e3);n<=0?(e.setData({"countdown.expired":!0,"countdown.totalSeconds":0,"countdown.timeText":""}),e.clearCountdown(),wx.showModal({title:"验证码已过期",content:"当前验证码已过期，请重新获取验证码",showCancel:!1,confirmText:"重新获取",success:function(){e.refreshVerificationCode()}})):(e.setData({"countdown.totalSeconds":n}),e.updateCountdownDisplay(n))}),1e3)}},updateCountdownDisplay:function(t){var e=Math.floor(t/86400),o=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),r=t%60,a="";e>0&&(a+="".concat(e,"天")),(o>0||e>0)&&(a+="".concat(o.toString().padStart(2,"0"),"时")),a+="".concat(n.toString().padStart(2,"0"),"分").concat(r.toString().padStart(2,"0"),"秒"),this.setData({"countdown.timeText":a})},clearCountdown:function(){this.countdownTimer&&(clearInterval(this.countdownTimer),this.countdownTimer=null)},copyVerificationCode:function(){this.data.verificationCode&&wx.setClipboardData({data:this.data.verificationCode,success:function(){wx.showToast({title:"验证码已复制",icon:"success",duration:1500})},fail:function(){wx.showToast({title:"复制失败",icon:"error",duration:1500})}})},decryptVerificationDataWithTempKey:function(t,e){try{if(!t.startsWith("YAN_TEMP_")||!t.endsWith("_END"))throw new Error("无效的加密数据格式");var n=t.slice(9,-4),r=o.enc.Base64.parse(e),a=o.enc.Base64.parse(n),i=o.lib.WordArray.create(a.words.slice(0,4)),s=o.lib.WordArray.create(a.words.slice(4)),c=o.AES.decrypt({ciphertext:s},r,{iv:i,mode:o.mode.CBC,padding:o.pad.Pkcs7}).toString(o.enc.Utf8);if(!c)throw new Error("解密结果为空");return JSON.parse(c)}catch(t){throw new Error("解密失败")}},decryptVerificationData:function(t){if(!t.startsWith("YAN_AES_")||!t.endsWith("_END"))throw new Error("数据格式错误");var e=t.slice(8,-4);try{var n=o.SHA256("Yan&!SD#asui*+.Ge"),r=o.enc.Base64.parse(e),a=o.lib.WordArray.create(r.words.slice(0,4)),i=o.lib.WordArray.create(r.words.slice(4)),s=o.AES.decrypt({ciphertext:i},n,{iv:a,mode:o.mode.CBC,padding:o.pad.Pkcs7}).toString(o.enc.Utf8);if(!s)throw new Error("解密结果为空");return JSON.parse(s)}catch(t){throw new Error("解密失败: ".concat(t))}},fetchHitokoto:function(){var t=this;this.setData({"hitokoto.loading":!0,"hitokoto.error":!1});var e=["d","b","i"],o=e[Math.floor(Math.random()*e.length)];wx.request({url:"https://v1.hitokoto.cn",method:"GET",header:{"content-type":"application/json; charset=utf-8"},data:{c:o,encode:"json",max_length:25},success:function(e){if(200===e.statusCode&&e.data){var o=e.data.hitokoto||"暂无内容";(o=String(o)).endsWith("。")&&(o=o.slice(0,-1)),o.length>25&&(o=o.substring(0,22)+"..."),t.setData({"hitokoto.text":o,"hitokoto.from":e.data.from||"","hitokoto.from_who":e.data.from_who||"","hitokoto.loading":!1,"hitokoto.error":!1})}else t.handleHitokotoError()},fail:function(){t.handleHitokotoError()}})},handleHitokotoError:function(){this.setData({"hitokoto.text":"享受今天，期待明天","hitokoto.from":"","hitokoto.from_who":"","hitokoto.loading":!1,"hitokoto.error":!0})},startExitAnimation:function(){var t=this;return new Promise((function(e){t.setData({"animationState.isExiting":!0}),setTimeout((function(){e(!0)}),400)}))},navigateBack:function(){this.startExitAnimation().then((function(){wx.navigateBack()}))},onShow:function(){this.setData({"animationState.isExiting":!1})},onHide:function(){},onUnload:function(){this.setData({"animationState.isEntering":!1,"animationState.isExiting":!1,"animationState.contentReady":!1}),this.clearCountdown()}});
},{isPage:true,isComponent:true,currentFile:'pages/code/code.js'});require("pages/code/code.js");